<link rel="stylesheet" href="/css/partials/modals.css">

<div id="reportModal" class="modal-backdrop">
    <div class="report-modal-comment">
        <h3>PRIJAVI KOMENTAR</h3>
        <form id="reportForm" onsubmit="submitReport(event)">
            <input type="hidden" id="reportCommentId" name="commentId">
            <div class="form-group">
                <label for="reportReason">Razlog prijave:</label>
                <textarea id="reportReason" name="reason" rows="4" placeholder="Zašto prijavljujete ovaj komentar?"
                    required></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-modal btn-cancel-comment"
                    onclick="closeReportModal()">Odustani</button>
                <button type="submit" class="btn-modal btn-report-confirm-comment">Pošalji prijavu</button>
            </div>
        </form>
    </div>
</div>

<script>
    function openReportModal(commentId) {
        document.getElementById('reportCommentId').value = commentId;
        document.getElementById('reportModal').classList.add('active');
    }

    function closeReportModal() {
        document.getElementById('reportModal').classList.remove('active');
        document.getElementById('reportForm').reset();
    }

    async function submitReport(event) {
        event.preventDefault();
        const commentId = document.getElementById('reportCommentId').value;
        const reason = document.getElementById('reportReason').value;

        try {
            const response = await fetch('/api/reports/comment', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ commentId, reason })
            });

            const data = await response.json();

            if (response.ok) {
                alert('Komentar uspješno prijavljen.');
                closeReportModal();
            } else {
                alert(data.message || 'Došlo je do greške.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Došlo je do greške.');
        }
    }
    window.onclick = function (event) {
        if (event.target == document.getElementById('reportModal')) {
            closeReportModal();
        }
    }
</script>