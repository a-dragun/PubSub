<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Detalji korisnika</title>
  <link rel="stylesheet" href="/css/admin/user.css">
  <script src="/js/admin/user.js" defer></script>
</head>
<body>
  <%- include('../../partials/header') %>
  <div class="user-container">
    <img class="profile-picture" src="<%= filteredUser.profilePicture %>" alt="Profilna slika korisnika" />

    <h1><%= filteredUser.name %></h1>
    <p><strong>Stvoren:</strong> <%= new Date(filteredUser.createdAt).toLocaleDateString('hr-HR') %></p>
    <p><strong>Admin level:</strong> <%= filteredUser.adminLevel %></p>
    <p><strong>Ukupni bodovi:</strong> <%= filteredUser.totalScore %></p>
    <p><strong>Prihvaćena pitanja:</strong> <%= filteredUser.questionsApproved %></p>

    <% if (filteredUser.isBanned) { %>
      <p class="banned"><strong>Razlog bana:</strong> <%= filteredUser.banReason %></p>
      <p class="banned"><strong>Trajanje bana:</strong> <%= filteredUser.banDuration %></p>
    <% } else if (filteredUser.isMuted) { %>
      <p class="muted"><strong>Razlog utišavanja:</strong> <%= filteredUser.muteReason %></p>
      <p class="muted"><strong>Trajanje utišavanja:</strong> <%= filteredUser.muteDuration %></p>
    <% } %>

    <form action="/admin/users/<%= filteredUser._id %>?_method=PUT" method="POST" class="admin-user-form">
      <input type="hidden" name="_method" value="PUT">
      <label for="adminLevel">Novi admin level:</label>
      <select name="adminLevel" id="adminLevel">
        <option value="0" <%= filteredUser.adminLevel === 0 ? "selected" : "" %>>Level 0</option>
        <option value="1" <%= filteredUser.adminLevel === 1 ? "selected" : "" %>>Level 1</option>
        <option value="2" <%= filteredUser.adminLevel === 2 ? "selected" : "" %>>Level 2</option>
      </select>
      <button type="submit" id="updateAdminBtn">Ažuriraj admin level</button>
    </form>

    <% if (!filteredUser.isBanned) { %>
      <span id="showBanFormBtn" class="toggle-link" onclick="toggleForm('banForm')">Ban</span>
      <form id="banForm" class="form-section" method="POST" action="/admin/users/<%= filteredUser._id %>/ban" style="display: none;">
        <label for="banReason">Razlog:</label>
        <input type="text" name="banReason" id="banReason" required>
        <label for="banDuration">Trajanje:</label>
        <input type="date" name="banDuration" id="banDuration" required min="<%= new Date(Date.now() + 86400000).toISOString().split('T')[0] %>">
        <button type="submit">Ban</button>
      </form>
    <% } else { %>
      <form class="unban-form" method="POST" action="/admin/users/<%= filteredUser._id %>/unban">
        <button type="submit" class="unban-btn">Unban</button>
      </form>
    <% } %>

    <% if (!filteredUser.isMuted) { %>
      <span id="showMuteFormBtn" class="toggle-link" onclick="toggleForm('muteForm')">Mute</span>
      <form id="muteForm" class="form-section" method="POST" action="/admin/users/<%= filteredUser._id %>/mute" style="display: none;">
        <label for="muteReason">Razlog:</label>
        <input type="text" name="muteReason" id="muteReason" required>
        <label for="muteDuration">Trajanje:</label>
        <input type="date" name="muteDuration" id="muteDuration" required min="<%= new Date(Date.now() + 86400000).toISOString().split('T')[0] %>">
        <button type="submit">Mute</button>
      </form>
    <% } else { %>
      <form class="unmute-form" method="POST" action="/admin/users/<%= filteredUser._id %>/unmute">
        <button type="submit" class="unmute-btn">Unmute</button>
      </form>
    <% } %>

    <form method="POST" action="/admin/users/<%= filteredUser._id %>?_method=DELETE">
      <input type="hidden" name="_method" value="DELETE">
      <button type="submit" id="deleteBtn" class="delete-btn">Izbriši korisnika</button>
    </form>
  </div>
</body>
</html>
